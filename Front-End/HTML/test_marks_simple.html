<!DOCTYPE html>
<html>
<head>
    <title>Test Course Marks</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        .success { color: green; }
        .error { color: red; }
        table { border-collapse: collapse; margin: 20px 0; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
    </style>
</head>
<body>
    <h1>Course Marks Data Verification</h1>
    <div id="output"></div>

    <script src="/static/JS/api.js"></script>
    <script>
        // Set logged in user
        localStorage.setItem('loggedInUser', JSON.stringify({
            id: 1,
            name: 'Asjal',
            role: 'student'
        }));

        async function test() {
            const output = document.getElementById('output');
            const studentId = 1;
            const courseId = 2;

            try {
                output.innerHTML += '<h2>Fetching Data...</h2>';

                // Fetch data
                const [marks, courses, courseMarks] = await Promise.all([
                    API.marks.getStudentCourse(studentId, courseId),
                    API.courses.getAll(),
                    API.marks.getByCourse(courseId)
                ]);

                output.innerHTML += `<p class="success">✓ Data fetched successfully</p>`;
                
                const mark = marks[0];
                const course = courses.find(c => c.course_id === courseId);

                output.innerHTML += `
                    <h2>Course: ${course.course_name} (${course.course_code})</h2>
                    <table>
                        <tr><th>Assessment</th><th>Value</th></tr>
                        <tr><td>Quiz 1</td><td>${mark.quiz1}</td></tr>
                        <tr><td>Quiz 2</td><td>${mark.quiz2}</td></tr>
                        <tr><td>Quiz 3</td><td>${mark.quiz3}</td></tr>
                        <tr><td><strong>Quiz Total</strong></td><td><strong>${mark.quiz_total}</strong></td></tr>
                        <tr><td>Assignment 1</td><td>${mark.assignment1}</td></tr>
                        <tr><td>Assignment 2</td><td>${mark.assignment2}</td></tr>
                        <tr><td>Assignment 3</td><td>${mark.assignment3}</td></tr>
                        <tr><td><strong>Assignment Total</strong></td><td><strong>${mark.assignment_total}</strong></td></tr>
                        <tr><td>Midterm 1</td><td>${mark.midterm1}</td></tr>
                        <tr><td>Midterm 2</td><td>${mark.midterm2}</td></tr>
                        <tr><td>Final Exam</td><td>${mark.final_exam}</td></tr>
                        <tr><td><strong>Total Marks</strong></td><td><strong>${mark.total_marks}</strong></td></tr>
                        <tr><td><strong>Grade</strong></td><td><strong>${mark.grade_letter}</strong></td></tr>
                    </table>

                    <h3>Class Statistics (${courseMarks.length} students)</h3>
                    <p>Average: ${(courseMarks.reduce((sum, m) => sum + parseFloat(m.total_marks), 0) / courseMarks.length).toFixed(2)}</p>
                `;

            } catch (error) {
                output.innerHTML += `<p class="error">✗ Error: ${error.message}</p>`;
                console.error(error);
            }
        }

        test();
    </script>
</body>
</html>
